---                                                                                     
name: commit
description: "Gitのコミットを作成する際のルール"
allowed-tools: Bash(git log*)
---

# コミットルール

## コミットの単位

- 1つのコミットには1つの意味の変更だけを入れる
    - 例えば「新しい機能の追加」「インデントの変更」「既存変数のリネーム」などを1つのコミットに混ぜない
    - 「インデントの変更」や「既存変数のリネーム」の内容が軽微であったとしても、混在すると差分が非常に見づらくなることを意識する
- 逆に、1つの意味の変更を1つのコミットにまとめる必要はない
    - 例えば「新しい機能の追加」を完成させると数十行、数百行に及ぶ差分になるような場合、それを1つのコミットだけにまとめる必要はない
    - 小さめにコミットを分けて、段階的に新しい機能の追加を完成させることが望ましい

## コミットメッセージ

- 特に指定がない限り日本語で記載する
- 下記のような意思決定を残す
    - 期待する振る舞い（仕様）
    - 採った方針と代替案
    - 懸念点やリスク
    - 上記のすべてを書く必要はなく、そのコミットにおいて重要だった意思決定を残す
- 差分を見れば分かるようなことだけを書くのは原則的に避ける
    - 前述の意思決定と差分の概要をセットで残すことを意識する
- 文体などについては、作業ブランチの過去5件程度のコミットを参照して、それらと合わせる
    - 作業ブランチにまだコミットがない、あるいは少ない場合、派生元ブランチのコミットを参照する必要はない


### prefix

- コミットの意図（種類）を明確にするため、コミットメッセージには必ずprefixを付与する
    - feat: 新しい機能やロジックの追加
    - fix: 不具合修正など、既存コードの問題点を修正するもの
    - test: テストに関する変更
    - doc: 関数の説明やコメント、Markdownファイルなどドキュメント関連の変更
    - style: コードの見た目を変更（インデントや改行の変更など）
    - chore: ツールなどで自動生成されたものや、上記のどれにも当てはまらない軽微な変更

例:

```
fix: 検索結果が0件の場合に`IndexOutOfBoundsException`が発生していたため、空チェックを追加しました
```

## コードの品質確保

- コミットを行う際、特別な理由がない限り、コンパイルエラーや文法エラーが発生しておらず、ビルドが通ることを確認する
- テストコードが存在する場合、全てのテストがパスすることを確認する
    - ただしテストコードが大量にある場合など、毎回の全実行が現実的でない場合は対象のテストコードを絞ることをユーザに相談できる

